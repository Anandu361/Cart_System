<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>Login</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
	</head>
	<body>
		<div class="container-fluid bg-primary">
			<div class="d-flex flex-coloumn justify-content-center align-items-center vh-100">
				<div class="card w-25 m-4 p-4">
					<div class="card-body">
						<h2 class="card-title text-center pb-2">Login</h2>
						<form id="loginForm">
							<div class="mb-3">
							  <label for="email" class="form-label">Email address</label>
							  <input type="email" class="form-control" id="email" required placeholder="name@example.com">
							</div>
							
							<div class="mb-3">
							  <label for="password" class="form-label">Password</label>
							  <input type="password" class="form-control" id="password" required>
							</div>

						    <div class="mx-auto d-flex p-2">
								<button type="submit" class="btn btn-primary mx-auto">Login</button>
							</div>
						</form>
						<p class="text-center">New user? <a class="icon-link icon-link-hover" th:href="@{/register}">Register<svg xmlns="http://www.w3.org/2000/svg" class="bi" viewBox="0 0 16 16" aria-hidden="true">
						    <path d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
						  </svg></a></p>
						  <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>
					</div>
				</div>
			</div>
		</div>
		<script>
		    document.getElementById("loginForm").addEventListener("submit", function(e) {
		        e.preventDefault();

		        const email = document.getElementById("email").value;
		        const password = document.getElementById("password").value;

		        fetch("http://localhost:8080/api/auth/login", {
		            method: "POST",
		            headers: {
		                "Content-Type": "application/json"
		            },
		            body: JSON.stringify({
		                email: email,
		                password: password
		            })
		        })
		        .then(res => res.text())
		        .then(data => {
		            if (data && data.length > 20) {
		                localStorage.setItem("token", data);   // ✅ store JWT
		                window.location.href = "/home";       // ✅ redirect
		            } else {
						const alertBox = document.getElementById("errorAlert");
						alertBox.innerText = "Wrong password!";
						alertBox.classList.remove("d-none");

		            }
		        });
		    });
		</script>
	</body>
</html>